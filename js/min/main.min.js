!function(){function t(){function t(t,o,i,d){a(c,l);{var u=topojson.feature(i,i.objects.EuropeCountries),p=topojson.feature(d,d.objects.FranceRegions).features;c.append("path").datum(u).attr("class","countries").attr("d",l)}p=r(p,o);var f=n(o);e(p,c,l,f),s(o,f)}var o=.5*window.innerWidth,i=460,c=d3.select("body").append("svg").attr("class","map").attr("width",o).attr("height",i),d=d3.geo.albers().center([0,46.2]).rotate([-2,0]).parallels([43,62]).scale(2500).translate([o/2,i/2]),l=d3.geo.path().projection(d);d3_queue.queue().defer(d3.csv,"data/unitsData.csv").defer(d3.json,"data/EuropeCountries.topojson").defer(d3.json,"data/FranceRegions.topojson").await(t)}function a(t,a){{var r=d3.geo.graticule().step([5,5]);t.append("path").datum(r.outline()).attr("class","gratBackground").attr("d",a),t.selectAll(".gratLines").data(r.lines()).enter().append("path").attr("class","gratLines").attr("d",a)}}function r(t,a){for(var r=0;r<a.length;r++)for(var e=a[r],n=e.adm1_code,o=0;o<t.length;o++){var s=t[o].properties,c=s.adm1_code;c==n&&i.forEach(function(t){var a=parseFloat(e[t]);s[t]=a})}return t}function e(t,a,r,e){a.selectAll(".regions").data(t).enter().append("path").attr("class",function(t){return"regions "+t.properties.adm1_code}).attr("d",r).style("fill",function(t){return o(t.properties,e)})}function n(t){for(var a=["#D4B9DA","#C994C7","#DF65B0","#DD1C77","#980043"],r=d3.scale.threshold().range(a),e=[],n=0;n<t.length;n++){var o=parseFloat(t[n][c]);e.push(o)}var s=ss.ckmeans(e,5);return e=s.map(function(t){return d3.min(t)}),e.shift(),r.domain(e),r}function o(t,a){var r=parseFloat(t[c]);return r&&0/0!=r?a(r):"#CCC"}function s(t,a){{var r=.425*window.innerWidth,e=473,n=25,s=2,i=5,d=r-n-s,l=e-2*i,u="translate("+n+","+i+")",p=d3.select("body").append("svg").attr("width",r).attr("height",e).attr("class","chart"),f=(p.append("rect").attr("class","chartBackground").attr("width",d).attr("height",l).attr("transform",u),d3.scale.linear().range([463,0]).domain([0,100])),h=(p.selectAll(".bar").data(t).enter().append("rect").sort(function(t,a){return a[c]-t[c]}).attr("class",function(t){return"bar "+t.adm1_code}).attr("width",d/t.length-1).attr("x",function(a,r){return r*(d/t.length)+n}).attr("height",function(t){return 463-f(parseFloat(t[c]))}).attr("y",function(t){return f(parseFloat(t[c]))+i}).style("fill",function(t){return o(t,a)}),p.append("text").attr("x",40).attr("y",40).attr("class","chartTitle").text("Number of Variable "+c[3]+" in each region"),d3.svg.axis().scale(f).orient("left"));p.append("g").attr("class","axis").attr("transform",u).call(h),p.append("rect").attr("class","chartFrame").attr("width",d).attr("height",l).attr("transform",u)}}var i=["varA","varB","varC","varD","varE"],c=i[0];window.onload=t()}();