!function(){function t(){function t(t,o,l,c){e(d,u);{var p=topojson.feature(l,l.objects.EuropeCountries),f=topojson.feature(c,c.objects.FranceRegions).features;d.append("path").datum(p).attr("class","countries").attr("d",u)}f=n(f,o);var h=a(o);r(f,d,u,h),s(o,h),i(o)}var o=.5*window.innerWidth,l=460,d=d3.select("body").append("svg").attr("class","map").attr("width",o).attr("height",l),c=d3.geo.albers().center([0,46.2]).rotate([-2,0]).parallels([43,62]).scale(2500).translate([o/2,l/2]),u=d3.geo.path().projection(c);d3_queue.queue().defer(d3.csv,"data/unitsData.csv").defer(d3.json,"data/EuropeCountries.topojson").defer(d3.json,"data/FranceRegions.topojson").await(t)}function e(t,e){{var n=d3.geo.graticule().step([5,5]);t.append("path").datum(n.outline()).attr("class","gratBackground").attr("d",e),t.selectAll(".gratLines").data(n.lines()).enter().append("path").attr("class","gratLines").attr("d",e)}}function n(t,e){for(var n=0;n<e.length;n++)for(var r=e[n],a=r.adm1_code,o=0;o<t.length;o++){var s=t[o].properties,i=s.adm1_code;i==a&&h.forEach(function(t){var e=parseFloat(r[t]);s[t]=e})}return t}function r(t,e,n,r){{var a=e.selectAll(".regions").data(t).enter().append("path").attr("class",function(t){return"regions "+t.properties.adm1_code}).attr("d",n).style("fill",function(t){return o(t.properties,r)}).on("mouseover",function(t){c(t.properties)}).on("mouseout",function(t){p(t.properties)}).on("mousemove",f);a.append("desc").text('{"stroke": "#000", "stroke-width": "0.5px"}')}}function a(t){for(var e=["#D4B9DA","#C994C7","#DF65B0","#DD1C77","#980043"],n=d3.scale.threshold().range(e),r=[],a=0;a<t.length;a++){var o=parseFloat(t[a][v]);r.push(o)}var s=ss.ckmeans(r,5);return r=s.map(function(t){return d3.min(t)}),r.shift(),n.domain(r),n}function o(t,e){var n=parseFloat(t[v]);return n&&0/0!=n?e(n):"#CCC"}function s(t,e){{var n=d3.select("body").append("svg").attr("width",g).attr("height",m).attr("class","chart"),r=(n.append("rect").attr("class","chartBackground").attr("width",k).attr("height",y).attr("transform",A),n.selectAll(".bar").data(t).enter().append("rect").sort(function(t,e){return e[v]-t[v]}).attr("class",function(t){return"bar "+t.adm1_code}).attr("width",k/t.length-1).on("mouseover",c).on("mouseout",p).on("mousemove",f)),a=(r.append("desc").text('{"stroke": "none", "stroke-width": "0px"}'),n.append("text").attr("x",40).attr("y",40).attr("class","chartTitle"),d3.svg.axis().scale(C).orient("left"));n.append("g").attr("class","axis").attr("transform",A).call(a),n.append("rect").attr("class","chartFrame").attr("width",k).attr("height",y).attr("transform",A)}d(r,t.length,e)}function i(t){{var e=d3.select("body").append("select").attr("class","dropdown").on("change",function(){l(this.value,t)});e.append("option").attr("class","titleOption").attr("disabled","true").text("Select Attribute"),e.selectAll("attrOptions").data(h).enter().append("option").attr("value",function(t){return t}).text(function(t){return t})}}function l(t,e){v=t;var n=a(e),r=(d3.selectAll(".regions").transition().duration(1e3).style("fill",function(t){return o(t.properties,n)}),d3.selectAll(".bar").sort(function(t,e){return e[v]-t[v]}).transition().delay(function(t,e){return 20*e}).duration(500));d(r,e.length,n)}function d(t,e,n){t.attr("x",function(t,n){return n*(k/e)+b}).attr("height",function(t){return 463-C(parseFloat(t[v]))}).attr("y",function(t){return C(parseFloat(t[v]))+x}).style("fill",function(t){return o(t,n)});d3.select(".chartTitle").text("Number of Variable "+v[3]+" in each region")}function c(t){d3.selectAll("."+t.adm1_code).style({stroke:"blue","stroke-width":"2"});u(t)}function u(t){{var e="<h1>"+t[v]+"</h1><b>"+v+"</b>",n=d3.select("body").append("div").attr({"class":"infolabel",id:t.adm1_code+"_label"}).html(e);n.append("div").attr("class","labelname").html(t.name)}}function p(t){function e(t,e){var n=d3.select(t).select("desc").text(),r=JSON.parse(n);return r[e]}d3.selectAll("."+t.adm1_code).style({stroke:function(){return e(this,"stroke")},"stroke-width":function(){return e(this,"stroke-width")}});d3.select(".infolabel").remove()}function f(){var t=d3.select(".infolabel").node().getBoundingClientRect().width,e=d3.event.clientX+10,n=d3.event.clientY-75,r=d3.event.clientX-t-10,a=d3.event.clientY+25,o=d3.event.clientX>window.innerWidth-t-20?r:e,s=d3.event.clientY<75?a:n;d3.select(".infolabel").style({left:o+"px",top:s+"px"})}var h=["varA","varB","varC","varD","varE"],v=h[0],g=.425*window.innerWidth,m=473,b=25,w=2,x=5,k=g-b-w,y=m-2*x,A="translate("+b+","+x+")",C=d3.scale.linear().range([463,0]).domain([0,110]);window.onload=t()}();